\chapter{Affin-lineare Chiffre}

\section{Vorbemerkung}

\subsection{$n\times m$-Matrix}

\[
\begin{pmatrix}
	a_{11} & \ldots & a_{1m} \\
	\vdots &  & \vdots \\
	a_{n1} & \ldots & a_{nm}
\end{pmatrix}
\]

$1 \times n$ = Zeilenvektor = $(a_1,\ldots,a_m)$

$n \times 1$ = Spaltenvektor = $\begin{pmatrix} b_1 \\ \vdots \\ b_n \end{pmatrix}$

z.B. $a_{ij} \in \R,\ a_{ij} \in \Z$ oder $a_{ij} \in R,\ R$ Ring

$n \times m$-Matrix A,B
\[
\begin{pmatrix}
	a_{11} & \ldots & a_{1m} \\
	\vdots &  & \vdots \\
	a_{n1} & \ldots & a_{nm}
\end{pmatrix}
+
\begin{pmatrix}
	b_{11} & \ldots & b_{1m} \\
	\vdots &  & \vdots \\
	b_{n1} & \ldots & b_{nm}
\end{pmatrix}
:=
\begin{pmatrix}
	a_{11}+b_{11} & \ldots & a_{1m}+b_{1m} \\
	\vdots &  & \vdots \\
	a_{n1}+b_{n1} & \ldots & a_{nm}+b_{nm}
\end{pmatrix}
\]
\[
A=n\times m,\ B = m \times k,
\]
\[
A \cdot B
\begin{pmatrix}
	c_{1l} & \ldots & c_{1k} \\
	\vdots &  & \vdots \\
	c_{m1} & \ldots & c_{mk}
\end{pmatrix}
=
n\times k
\]
\[
c_{1l}=(a_{i1} \cdot b_{ij})+(a_{i2} \cdot b_{2j}) + \ldots + (a_{im} \cdot b_{mj})
\]
\[
(A+B)\cdot C = A\cdot B + B\cot C
\]

Im Allgemeinem: $A\cdot B \neq B\cdot A$\\

\subsection{Quadritsche Matrix ($n\times n$)}

\[
E_n=\begin{pmatrix}
	1 & \ldots & 0 \\
	\vdots & \ddots & \vdots \\
	0 & \ldots & 1
\end{pmatrix}
\]
\[
A=n\times n,\ A \cdot E_n=E_n \cdot A = A
\]
$A\ n\times n$-Matrix über kommutativen Ring R mit Eins.\\
Wann existiert Matrix $A^{-1}$(Inverse Matrix) mit $A^{-1} \cdot A = A \cdot A^{-1} = E_n$?\\
$det(A) \in R$\ Determinante von A\\
\\
$2\times 2$-Matrix: $det\begin{pmatrix}
	a_{11} & a_{12} \\ a_{21} & a_{21}
\end{pmatrix}
= a_{11} \cdot a_{22} - a_{12} \cdot a_{21}$\\
\\
\\
A besitzt inverse Matrix $\Leftrightarrow det(A)$ in R ein inverses besitzt\\
(z.B. R Körper, $\Z ,\Q ,\Z_p,\ det(A)\neq 0$\\
\[
A^{-1}=
\begin{pmatrix}
	\frac{1}{det(A)}\cdot b_{11} & \ldots & \frac{1}{det(A)}\cdot b_{1m} \\
	\vdots & & \vdots \\
	\frac{1}{det(A)}\cdot b_{n1} & \ldots & \frac{1}{det(A)}\cdot b_{nm}
\end{pmatrix}
\]
$b_{ij}=(-1)^{i+j}$\ $det(A_{ji})$\\
\\
$A_{ji}=(n-1)\times (n-1)$-Matrix, die aus $A$ durchstreichen der $j$-ten Zeile und $i$-ten Spalte entsteht.
\[
A=
\begin{pmatrix}
	a_{11} & a_{12} \\ a_{21} & a_{22}
\end{pmatrix}\ \
A^{-1}=
\begin{pmatrix}
	a_{22} & -a_{12} \\ -a_{21} & a_{11}
\end{pmatrix}
\]
$R=\Z_k \ \{0,1,\ldots,k\}$\\
Addition und Multiplikation in $\Z_k (\oplus,\odot)$\\
normale Add. und Mult. mit $mod\, k$\\

\section{Affin-lineare Chiffren}
Klartextalphabet = Chiffretextalphabet = $\Z_k$ ($k=2,\ k=26$)\\
Wähle $n \times n$-Matrix $A$ über $\Z_k$ und Zeilenvektor $b$ der Länge $n$ über $\Z_k$. Dies wird der Schlüssel sein für die Chiffrierung.\\
Blockchiffre der Länge $n$. Block = Zeilenvektor der Länge $n$ über $\Z_k$.
Klartextblock $v$\\
Chiffretextblock $v \cdot A + b =: w$\\
$v \rightarrow v \cdot A +b =:w$
$w-b=v \cdot A$
benötigen: $A^{-1}$ existiert (d.h. $ggT(det(A),k)=1$)\\
Dechiffrierung: $(w-b)\cdot A^{-1} = v \cdot A \cdot A^{-1} = v \cdot E_n = v$\\
(wenn immer b=0 gewählt wird, dann lineare Chiffren, Hill-Chiffren)\\
Beispiel:\\
\[
A=
\begin{pmatrix}
	1 & 3 \\ 3 & 2
\end{pmatrix}
\ \Z_6
\]
Blockchiffre der Länge $n$
$det(A)=1 \cdot 2 - 3 \cdot 3 = -7 = 5$ inverse in $\Z_6$
\[
\frac{1}{det(A)}=det(A)^{-1}=5
\]
\[
A^{-1}=5\cdot
\begin{pmatrix}
	2&-3\\-3&1
\end{pmatrix}
=
\begin{pmatrix}
	10&-15\\-15&5
\end{pmatrix}
=
\begin{pmatrix}
	4&3\\3&5
\end{pmatrix}
\]
Test: 
\[
A \cdot A^{-1} = 
\begin{pmatrix}
	1 & 3 \\ 3 & 2
\end{pmatrix}
\cdot
\begin{pmatrix}
	4&3\\3&5
\end{pmatrix}
=
\begin{pmatrix}
	4+9&3+15\\12+6&9+10
\end{pmatrix}
=
\begin{pmatrix}
	1&0\\0&1
\end{pmatrix}
\]
Verschlüsselung:

Schlüssel:
$A = 
\begin{pmatrix}
	1 & 3 \\ 3 & 2
\end{pmatrix}
$ $b=(3,5)$

Klartextblock: $(1,2)$

Chiffretextblock: 
\[w=(1,2) \cdot 
\begin{pmatrix}
	1 & 3 \\ 3 & 2
\end{pmatrix}
+
(3,5)= (1,1)+(3,5) = (4,0)\]

Entschlüsselung:
\[ (w-b) \cdot A^{-1} = (1,1) \cdot 
\begin{pmatrix}
	4 & 3 \\ 3 & 5
\end{pmatrix}
=(1,2)
\]

$\Z_2 : n^2 + n$ Bit zur Speicherung eines Schlüssels.

Wieviele inverse Matrizen über $\Z_2$ mit $n=64$?

$(2^{64}-1) \cdot (2^{64}-2) \cdot \ldots \cdot (2^{64}-2^{63}) \approx 0.29 \cdot 2^{4096}$

Verfahren ist unsicher gegenüber Known-Plaintext-Angriffe.

$(A,b)$ Schlüssel, A inverse $n \times n$-Matrix über $\Z_k ,b \ \in \Z_k^n$

Angenommen Angreifer kennt $n+1$ Klartext/Chiffretextpaare verschlüsselt mit $(A,b),\ v_0, v_1,\ldots,v_n \ w_0,\ldots,w_n$

Dann kann er haufig $(A,b)$ bestimmen.

$V=
\begin{pmatrix}
	v_1-v_0\\v_2-v_0\\\vdots\\v_n-v_0
\end{pmatrix}
\ n \times n$-Matrix

Angenommen: V ist invertierbar. Setze $W=
\begin{pmatrix}
	w_1-w_0\\\vdots\\w_n-w_0
\end{pmatrix}$
\[
V \cdot A =
\begin{pmatrix}
	(v_1-v_0) \cdot A \\ \vdots \\(v_n-v_0) \cdot A
\end{pmatrix}
=
\begin{pmatrix}
	v_1 \cdot A + b - v_0 \cdot A +b \\ \vdots \\
	v_n \cdot A + b - v_0 \cdot A + b
\end{pmatrix}
=
\begin{pmatrix}
	w_1-w_0\\ \vdots\\w_n-w_0
\end{pmatrix}
=W
\]

$V \cdot A$ bekannt, also auch $V^{-1}$:

$A=V^{-1} \cdot w$

$b=w_0 - v_0 \cdot A$

Beispiel: $n=2,\ k=25 \ \ \{A,\ldots, Z\}=\{0,\ldots,25\}$

\begin{center}
\texttt{HERBST} $\longrightarrow$ \texttt{NEBLIG}

\begin{tabular}{l|l|l}
H & 7 & \multirow{2}{*}{$v_0$} \\
E & 4 & \\
\hline
R & 17 & \multirow{2}{*}{$v_1$} \\
B & 1 & \\
\hline
S & 18 & \multirow{2}{*}{$v_2$} \\
T & 19 &
\end{tabular}
$\longrightarrow$
\begin{tabular}{l|l|l}
N & 13 & \multirow{2}{*}{$w_0$} \\
E & 4 & \\
\hline
B & 1 & \multirow{2}{*}{$w_1$} \\
L & 11 & \\
\hline
I & 8 & \multirow{2}{*}{$w_2$} \\
G & 6 &
\end{tabular}
\end{center}
\[
V=
\begin{pmatrix}
	10 & -3 \\
	11 & 15
\end{pmatrix}
=
\begin{pmatrix}
	10 & 23\\
	11 & 15
\end{pmatrix}, \
W=
\begin{pmatrix}
	14 & 7 \\
	21 & 2
\end{pmatrix}
\]
\[
det(V) = 10 \cdot 15  + 33 = 183 \equiv 1 (mod\ 26)
\]
\[
V^{-1}=
\begin{pmatrix}
	15 & 3 \\
	-11 & 10 	
\end{pmatrix}
=
\begin{pmatrix}
	15 & 3 \\
	15 & 10 	
\end{pmatrix}
\]
\[
A=V^{-1} \cdot W =
\begin{pmatrix}
	15 & 3 \\
	15 & 10 	
\end{pmatrix}
\cdot
\begin{pmatrix}
	14 & 7 \\
	21 & 2
\end{pmatrix}
=
\begin{pmatrix}
	210+63 & 105+6 \\
	210+210 & 105+20
\end{pmatrix}
=
\begin{pmatrix}
	13 & 7\\
	4 & 21
\end{pmatrix}
\]
\[
b=w_0-v_0 \cdot A = (13,4) - (7,4) \cdot 
\begin{pmatrix}
	13 & 7\\
	4 & 21
\end{pmatrix}
=
(10,1)
\]

Test:
\[
v_1 \cdot A + b= w_1, v_2 \cdot A + b= w_2
\]
